version: '3'

env:
  COMPOSE_PROJECT_NAME: mage_skeleton
  UID:
    sh: 'if [ `echo $(id -u) -lt 1000` ]; then echo 1000; else echo $(id -u); fi'
  GID:
    sh: 'if [ `echo $(id -g) -lt 1000` ]; then echo 1000; else echo $(id -g); fi'

tasks:
  build:
    cmds:
    - UID=$UID GID=$GID docker-compose -f .docker/docker-compose.yml -f .docker/docker-compose.dev.yml -p $COMPOSE_PROJECT_NAME build
  up:
    cmds:
    - UID=$UID GID=$GID docker-compose -f .docker/docker-compose.yml -f .docker/docker-compose.dev.yml -p $COMPOSE_PROJECT_NAME up -d apache mysql dragonfly mailpit
  down:
    cmds:
    - UID=$UID GID=$GID docker-compose -f .docker/docker-compose.yml -f .docker/docker-compose.dev.yml -p $COMPOSE_PROJECT_NAME down
  clear:
    cmds:
    - UID=$UID GID=$GID docker-compose -f .docker/docker-compose.yml -f .docker/docker-compose.dev.yml -p $COMPOSE_PROJECT_NAME down --rmi all
  php:
    cmds:
    - UID=$UID GID=$GID docker-compose -f .docker/docker-compose.yml -f .docker/docker-compose.dev.yml -p $COMPOSE_PROJECT_NAME exec php {{.CLI_ARGS}}
  composer:
    cmds:
    - task: php
      vars: {CLI_ARGS: 'composer {{.CLI_ARGS}}'}
  artisan:
    cmds:
    - task: php
      vars: {CLI_ARGS: 'php artisan {{.CLI_ARGS}}'}
